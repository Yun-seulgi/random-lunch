<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì•„ì´ìƒµì¼€ì–´ ëœë¤ ëŸ°ì¹˜ íŒ€ë©”ì´ì»¤</title>
  <style>
    :root{
      --brand:#1463ff; --brand-dark:#221815;
      --bg:#f7f8fc; --card:#fff; --ink:var(--brand-dark); --sub:#6b7280; --line:#e8e9ef;
      --shadow:0 10px 30px rgba(17,24,39,.08);
      --shadow-sm:0 6px 14px rgba(17,24,39,.06);
      --radius:16px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;color:var(--ink);font:14px/1.5 system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",Arial;
      background:
        radial-gradient(1200px 500px at 80% -50%, #dbe8ff 0%, transparent 60%),
        radial-gradient(700px 450px at -10% 120%, #e7f3ff 0%, transparent 60%),
        var(--bg);
    }
    .wrap{max-width:1120px;margin:auto;padding:16px}

    .toolbar{position:sticky;top:0;z-index:10;backdrop-filter:blur(10px);background:linear-gradient(180deg,#ffffffcc,#ffffffb6);border-bottom:1px solid #e7ecf4}
    .toolbar .bar{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:12px 16px}
    .h1{display:flex;align-items:center;gap:10px;font-weight:800;color:var(--brand-dark)}
    .h1 .brand-dot{width:8px;height:8px;border-radius:50%;background:var(--brand)}
    .ctrls{display:flex;gap:8px;flex-wrap:wrap}
    .btn{appearance:none;border:1px solid var(--line);background:#fff;border-radius:12px;padding:10px 14px;cursor:pointer;transition:all .15s ease;box-shadow:var(--shadow-sm)}
    .btn:hover{transform:translateY(-1px); box-shadow:0 10px 18px rgba(17,24,39,.08)}
    .btn:active{transform:translateY(0)}
    .btn:disabled{opacity:.5;cursor:not-allowed;box-shadow:none}
    .btn.primary{background:var(--brand);color:#fff;border-color:transparent}
    .btn.primary:hover{filter:brightness(1.05)}

    .panel{display:grid;grid-template-columns:2fr 1fr;gap:16px;margin:16px 0;align-items:stretch}
    @media(max-width:860px){.panel{grid-template-columns:1fr}}
    .box{border:1px solid var(--line);border-radius:var(--radius);background:#fff;padding:14px;height:100%;display:flex;flex-direction:column;gap:12px;box-shadow:var(--shadow-sm)}
    .box label{display:block;color:var(--sub);font-weight:600}
    textarea{width:100%;min-height:180px;border:1px solid var(--line);border-radius:12px;padding:12px;resize:vertical;font:14px/1.45 inherit;flex:1 1 auto;transition:border .15s, box-shadow .15s}
    textarea:focus{outline:none;border-color:#c7d7ff;box-shadow:0 0 0 3px #dfe9ff}
    .field{display:flex;align-items:center;justify-content:space-between;gap:10px;margin:2px 0}
    .field input{border:1px solid var(--line);border-radius:10px;padding:8px 10px;width:220px;transition:border .15s, box-shadow .15s}
    .field input:focus{outline:none;border-color:#c7d7ff;box-shadow:0 0 0 3px #dfe9ff}
    .hint{color:var(--sub);font-size:12px}
    .brand-panel{margin-top:4px;display:flex;justify-content:center;align-items:center;padding:6px 0}
    .brand-panel img{max-width:100%;height:auto;max-height:80px;opacity:.95}

    .titlebar{display:flex;align-items:flex-end;justify-content:space-between;padding:8px 4px;margin-top:4px}
    .titlebar h2{margin:0;font-weight:900;color:var(--brand-dark);letter-spacing:.2px}
    .metachips{display:flex;gap:8px;flex-wrap:wrap}
    .chip{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;background:#fff;border:1px solid #e7ecf4;box-shadow:var(--shadow-sm);font-size:12px;color:#374151}
    .chip .dot{width:8px;height:8px;border-radius:50%;background:var(--brand)}

    #captureArea.grid{background:#fff;border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);padding:16px}
    .grid-cards{display:grid;grid-template-columns:repeat(1,minmax(0,1fr));gap:16px}
    @media(min-width:640px){.grid-cards{grid-template-columns:repeat(2,minmax(0,1fr))}}
    @media(min-width:1024px){.grid-cards{grid-template-columns:repeat(3,minmax(0,1fr))}}
    .card{position:relative;border:1px solid var(--line);border-radius:var(--radius);background:var(--card);box-shadow:var(--shadow-sm);overflow:hidden;animation:pop .35s ease both}
    .card:hover{transform:translateY(-2px);box-shadow:0 14px 26px rgba(17,24,39,.10)}
    @keyframes pop{from{opacity:.0;transform:translateY(8px)}to{opacity:1;transform:none}}
    .card-head{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border-bottom:1px solid #eef1f6;background:linear-gradient(180deg,#fcfdff,#f7f9ff)}
    .car-id{display:flex;align-items:center;gap:8px;color:#6b7280;font-weight:700}
    .car-id .id-dot{width:10px;height:10px;border-radius:50%;background:var(--tone,#cbd5e1);box-shadow:inset 0 0 0 2px #ffffff}
    .team-chip{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;background:#fff;border:1px solid var(--tone,#cbd5e1);font-weight:700}
    .team-chip .chip-dot{width:8px;height:8px;border-radius:50%;background:var(--tone,#cbd5e1)}
    .car-wrap{padding:14px}
    .foot{display:flex;align-items:center;justify-content:flex-start;padding:0 14px 14px 14px;color:var(--sub);font-size:12px}

    .seat{position:absolute;transform:translate(-50%,-50%)}
    .badge{
      position:relative;display:inline-block;background:#fff;border:2px solid var(--line);
      border-radius:12px;padding:6px 12px;font-weight:800;white-space:nowrap;
      overflow:visible;text-overflow:clip;box-shadow:0 1px 2px rgba(0,0,0,.06);
    }
    .badge.driver{background:#fff7d6;border-color:#facc15}
    .crown-float{
      position:absolute; left:50%; transform:translateX(-50%);
      bottom:calc(100% + 4px);
      background:#fff; border:2px solid #facc15; border-radius:999px;
      padding:2px 6px; line-height:1; font-size:14px;
      box-shadow:0 1px 2px rgba(0,0,0,.08);
    }

    .error{display:flex;align-items:flex-start;gap:8px;color:#b91c1c;background:#fee2e2;border:1px solid #fecaca;border-radius:12px;padding:10px 12px;margin-top:8px}
  </style>
</head>
<body>
  <div class="toolbar">
    <div class="bar wrap">
      <div class="h1"><span class="brand-dot"></span>ì•„ì´ìƒµì¼€ì–´ ëœë¤ ëŸ°ì¹˜ íŒ€ë©”ì´ì»¤</div>
      <div class="ctrls">
        <button class="btn primary" id="btnMake">ëœë¤ ì¡°í¸ì„±</button>
        <button class="btn" id="btnSave" disabled>PNGë¡œ ì €ì¥</button>
        <button class="btn" id="btnCopy" disabled>ëª…ë‹¨ ë³µì‚¬</button>
      </div>
    </div>
  </div>

  <div class="wrap">
    <div class="panel">
      <div class="box">
        <label>ì´ ì¸ì› ì´ë¦„</label>
        <textarea id="inputNames" placeholder="ì‰¼í‘œ/ë„ì–´ì“°ê¸°/ì—”í„°ë¡œ êµ¬ë¶„"></textarea>
        <div class="hint">í˜„ì¬ ì¸ì›: <b id="count">0</b>ëª…</div>
      </div>
      <div class="box">
        <div class="field">
          <label class="muted">ì œëª©</label>
          <input id="title" placeholder="ì˜ˆ: 9ì›” ëœë¤ ëŸ°ì¹˜" />
        </div>
        <div class="hint">â€» í•´ë‹¹ ì œëª©ì€ íŒŒì¼ëª…ìœ¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤.</div>
        <div id="error" class="error" style="display:none">âš ï¸ í˜„ì¬ ì¸ì›ìœ¼ë¡œëŠ” ê· ë“±í•œ íŒ€ êµ¬ì„±ì´ ì–´ë ¤ì›Œìš”. (ì˜ˆ: 1, 2, 5ëª…ì€ ë¶ˆê°€)</div>
        <div class="brand-panel">
          <img src="./ishopcare-logo.png" alt="iShopCARE ë¡œê³ " />
        </div>
      </div>
    </div>

    <div class="titlebar">
      <div>
        <h2 id="outTitle">ëœë¤ ëŸ°ì¹˜</h2>
        <div id="meta" class="metachips"></div>
      </div>
    </div>

    <div id="captureArea" class="grid">
      <div class="grid-cards" id="cards"></div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/html-to-image@1.11.11/dist/html-to-image.min.js"></script>
  <script>
    const byId = id => document.getElementById(id);
    const $names=byId('inputNames'), $count=byId('count');
    const $btnMake=byId('btnMake'), $btnSave=byId('btnSave'), $btnCopy=byId('btnCopy');
    const $error=byId('error'), $cards=byId('cards'), $meta=byId('meta');
    const $titleIn=byId('title'), $titleOut=byId('outTitle'), $capture=byId('captureArea');

    function splitNames(text){ return text.replace(/[ï¼Œã€;]+/g, ',').split(/[\s,]+/).map(s=>s.trim()).filter(Boolean); }
    function shuffle(a){a=[...a]; for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j]]; } return a;}
    /* fixed shuffle bug */ function shuffle(a){a=[...a]; for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]];} return a;}

    /* color helpers */
    function hexToRgb(hex){ const v=hex.replace('#',''); const n=v.length===3? v.split('').map(x=>x+x).join(''):v; return {r:parseInt(n.slice(0,2),16), g:parseInt(n.slice(2,4),16), b:parseInt(n.slice(4,6),16)};}
    function rgbToHex(r,g,b){ const h=n=>n.toString(16).padStart(2,'0'); return `#${h(r)}${h(g)}${h(b)}`; }
    function clamp01(x){ return Math.max(0, Math.min(255, x)); }
    function tint(hex, p){ const {r,g,b}=hexToRgb(hex); const t=p/100; return rgbToHex(clamp01(r+(255-r)*t), clamp01(g+(255-g)*t), clamp01(b+(255-b)*t)); }
    function shade(hex, p){ const {r,g,b}=hexToRgb(hex); const t=1-(p/100); return rgbToHex(Math.round(r*t), Math.round(g*t), Math.round(b*t)); }

    /* ì°¨ì¢… ëª©ë¡ */
    const carModels = [
      'í˜„ëŒ€ ì•„ë°˜ë–¼','í˜„ëŒ€ ì˜ë‚˜íƒ€','í˜„ëŒ€ ê·¸ëœì €','í˜„ëŒ€ ì‹¼íƒ€í˜','í˜„ëŒ€ íŒ°ë¦¬ì„¸ì´ë“œ','í˜„ëŒ€ ì½”ë‚˜','í˜„ëŒ€ íˆ¬ì‹¼','í˜„ëŒ€ ì•„ì´ì˜¤ë‹‰5','í˜„ëŒ€ ì•„ì´ì˜¤ë‹‰6',
      'ê¸°ì•„ ëª¨ë‹','ê¸°ì•„ ë ˆì´','ê¸°ì•„ K3','ê¸°ì•„ K5','ê¸°ì•„ K8','ê¸°ì•„ ìŠ¤í¬í‹°ì§€','ê¸°ì•„ ì˜ë Œí† ','ê¸°ì•„ ì¹´ë‹ˆë°œ','ê¸°ì•„ EV6',
      'ì œë„¤ì‹œìŠ¤ G70','ì œë„¤ì‹œìŠ¤ G80','ì œë„¤ì‹œìŠ¤ G90','ì œë„¤ì‹œìŠ¤ GV70','ì œë„¤ì‹œìŠ¤ GV80',
      'í…ŒìŠ¬ë¼ ëª¨ë¸3','í…ŒìŠ¬ë¼ ëª¨ë¸Y','í…ŒìŠ¬ë¼ ëª¨ë¸S','í…ŒìŠ¬ë¼ ëª¨ë¸X',
      'BMW 3ì‹œë¦¬ì¦ˆ','BMW 5ì‹œë¦¬ì¦ˆ','BMW X3','BMW X5','BMW i4','BMW iX',
      'ë©”ë¥´ì„¸ë°ìŠ¤-ë²¤ì¸  Cí´ë˜ìŠ¤','ë©”ë¥´ì„¸ë°ìŠ¤-ë²¤ì¸  Eí´ë˜ìŠ¤','ë©”ë¥´ì„¸ë°ìŠ¤-ë²¤ì¸  GLC','ë©”ë¥´ì„¸ë°ìŠ¤-ë²¤ì¸  GLE',
      'ì•„ìš°ë”” A4','ì•„ìš°ë”” A6','ì•„ìš°ë”” Q5','ì•„ìš°ë”” Q7','ì•„ìš°ë”” e-tron',
      'í­ìŠ¤ë°”ê² í‹°êµ¬ì•ˆ','í­ìŠ¤ë°”ê² ê³¨í”„','í­ìŠ¤ë°”ê² ID.4',
      'ë³¼ë³´ XC40','ë³¼ë³´ XC60','ë³¼ë³´ XC90','ë³¼ë³´ S60',
      'í† ìš”íƒ€ í”„ë¦¬ìš°ìŠ¤','í† ìš”íƒ€ ìº ë¦¬','í† ìš”íƒ€ ë¼ë¸Œ4','í† ìš”íƒ€ GR86',
      'ë ‰ì„œìŠ¤ ES','ë ‰ì„œìŠ¤ NX','ë ‰ì„œìŠ¤ RX',
      'í˜¼ë‹¤ ì‹œë¹…','í˜¼ë‹¤ ì–´ì½”ë“œ','í˜¼ë‹¤ CR-V',
      'ë‹›ì‚° ì•Œí‹°ë§ˆ','ë‹›ì‚° ë¡œê·¸','ë‹›ì‚° Z',
      'í¬ë¥´ì‰ 911','í¬ë¥´ì‰ ì¹´ì´ì—”','í¬ë¥´ì‰ íŒŒë‚˜ë©”ë¼','í¬ë¥´ì‰ ë§ˆì¹¸','í¬ë¥´ì‰ íƒ€ì´ì¹¸',
      'í˜ë¼ë¦¬ í¬ë¥´í† í”¼ë…¸','ëŒë³´ë¥´ê¸°ë‹ˆ ìš°ë£¨ìŠ¤','ë§ˆì„¸ë¼í‹° ê·¸ë ˆì¹¼ë ˆ',
      'í¬ë“œ ë¸Œë¡±ì½”','í¬ë“œ ìµìŠ¤í”Œë¡œëŸ¬','í¬ë“œ ë¨¸ìŠ¤íƒ±',
      'ì‰ë³´ë ˆ íŠ¸ë˜ë²„ìŠ¤','ì‰ë³´ë ˆ ë§ë¦¬ë¶€','ì‰ë³´ë ˆ íŠ¸ë ˆì¼ë¸”ë ˆì´ì €',
      'ì§€í”„ ë ˆë‹ˆê²Œì´ë“œ','ì§€í”„ ë­ê¸€ëŸ¬','ì§€í”„ ê·¸ëœë“œì²´ë¡œí‚¤',
      'ë¥´ë…¸ XM3','ë¥´ë…¸ SM6','ìŒìš© í† ë ˆìŠ¤','ìŒìš© ë ‰ìŠ¤í„´'
    ];

    function uniqueCarNames(n){
      const pool = [...carModels];
      const shuffled = shuffle(pool);
      if (n <= shuffled.length) return shuffled.slice(0, n);
      const extra = [];
      let i = 0, round = 2;
      while (shuffled.length + extra.length < n){
        extra.push(`${pool[i % pool.length]} â€¢${round}`);
        i++; if (i % pool.length === 0) round++;
      }
      return [...shuffled, ...extra].slice(0, n);
    }

    /* íŒ¬í†¤í’ íŒŒìŠ¤í…”/ë‰´íŠ¸ëŸ´ íŒ”ë ˆíŠ¸ (ì €ì±„ë„, ê³ ëª…ë„) */
    function teamColors(n){
      const BASES = [
        '#FFBE98', /* peach fuzz vib. */
        '#9BBFA1', /* sage */
        '#8FB3D9', /* misty blue */
        '#B8A1D9', /* soft lavender */
        '#D9836B', /* terracotta */
        '#E7CBA9', /* sand beige */
        '#7AA7A3', /* dusty teal */
        '#C4A484', /* camel */
        '#8E9AAF', /* slate lilac */
        '#A3C4B8', /* mint gray */
        '#F2C6DE', /* powder pink */
        '#93A8AC', /* blue gray */
        '#F0B265', /* muted amber */
        '#C7B9FF', /* lilac mist */
        '#A7D3A6', /* pastel green */
        '#D2A6A4'  /* dusty rose */
      ];
      const arr=[];
      for(let i=0;i<n;i++){
        const base = BASES[i % BASES.length];
        arr.push({
          base,                 // ë©”ì¸
          pale: tint(base, 88), // ì•„ì£¼ ì˜…ì€ ë°°ê²½
          dark: shade(base,18)  // ì‚´ì§ ì–´ë‘ìš´ ê·¸ë¼ë°ì´ì…˜/í…Œë‘ë¦¬ìš©
        });
      }
      return arr;
    }

    const seatLayout = [
      {x:78,y:65}, {x:162,y:65}, {x:78,y:165}, {x:162,y:165}
    ];

    function shrinkToFit(badge, maxWidth){
      const base = parseInt(getComputedStyle(badge).fontSize, 10) || 14;
      let fs = base; badge.style.fontSize = '';
      while (badge.scrollWidth > maxWidth && fs > 11){
        fs -= 1; badge.style.fontSize = fs + 'px';
      }
    }
    function clamp(v,min,max){return Math.max(min,Math.min(max,v));}
    function fitBadgesInsideCar(svgBox){
      const margin = 6;
      const front = { left:35, right:205, top:30,  bottom:100 };
      const rear  = { left:35, right:205, top:130, bottom:200 };
      const seats = svgBox.querySelectorAll('.seat');

      const adjustPair = (aIdx, bIdx, area) => {
        const A = seats[aIdx], B = seats[bIdx];
        const get = s => s && s.querySelector('.badge') ? { seat:s, badge:s.querySelector('.badge') } : null;

        const SA = get(A), SB = get(B);
        const avail = area.right - area.left - 2*margin;
        const gap = 8;
        const half = Math.floor((avail - gap) / 2);

        [SA, SB].forEach(X => { if(!X) return; shrinkToFit(X.badge, half); });

        [SA, SB].forEach((X, i) => {
          if (!X) return;
          const w = X.badge.offsetWidth, h = X.badge.offsetHeight;
          const cy0 = parseFloat(X.seat.style.top);
          const cx = i === 0 ? area.left+margin+w/2 : area.right-margin-w/2;
          X.seat.style.left = cx + 'px';
          X.seat.style.top  = clamp(cy0, area.top+margin+h/2, area.bottom-margin-h/2) + 'px';
        });
      };

      adjustPair(0, 1, front);
      adjustPair(2, 3, rear);
    }

    /* ìë™ì°¨ SVG (íŒ€ í…ìŠ¤íŠ¸ ì œê±°, ë¼ì´íŠ¸ ìœ ì§€) */
    function svgCar(i, theme){
      return `
      <svg width="240" height="230" viewBox="0 0 240 230">
        <defs>
          <linearGradient id="body${i}" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0%" stop-color="${theme.base}" />
            <stop offset="100%" stop-color="${theme.dark}" />
          </linearGradient>
          <linearGradient id="glass${i}" x1="0" y1="0" x2="0" y2="1">
            <stop offset="0%" stop-color="#f8fbff" stop-opacity="0.96"/>
            <stop offset="100%" stop-color="#e8f0ff" stop-opacity="0.92"/>
          </linearGradient>
          <radialGradient id="rim${i}" cx="50%" cy="50%" r="50%">
            <stop offset="0%" stop-color="#e5e7eb"/>
            <stop offset="100%" stop-color="#9aa3af"/>
          </radialGradient>
          <linearGradient id="head${i}" x1="0" y1="0" x2="1" y2="0">
            <stop offset="0%" stop-color="#ffffff" stop-opacity="1"/>
            <stop offset="100%" stop-color="#cde7ff" stop-opacity="1"/>
          </linearGradient>
          <linearGradient id="tail${i}" x1="0" y1="0" x2="1" y2="0">
            <stop offset="0%" stop-color="#ffb3b3"/>
            <stop offset="100%" stop-color="#ff4545"/>
          </linearGradient>
          <filter id="glow${i}" x="-50%" y="-50%" width="200%" height="200%">
            <feGaussianBlur stdDeviation="2.5" result="blur"/>
            <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
          </filter>
        </defs>

        <ellipse cx="120" cy="214" rx="90" ry="10" fill="#00000018"/>

        <g opacity="0.98">
          <circle cx="36"  cy="58"  r="18" fill="#0b1220"/><circle cx="36"  cy="58"  r="9" fill="url(#rim${i})"/>
          <circle cx="204" cy="58"  r="18" fill="#0b1220"/><circle cx="204" cy="58"  r="9" fill="url(#rim${i})"/>
          <circle cx="36"  cy="172" r="18" fill="#0b1220"/><circle cx="36"  cy="172" r="9" fill="url(#rim${i})"/>
          <circle cx="204" cy="172" r="18" fill="#0b1220"/><circle cx="204" cy="172"  r="9" fill="url(#rim${i})"/>
        </g>

        <path d="M26,110 C26,70, 38,44, 60,34 C85,22, 155,22, 180,34 C202,44, 214,70, 214,110 C214,150, 202,176, 180,186 C155,198, 85,198, 60,186 C38,176, 26,150, 26,110 Z"
          fill="url(#body${i})" stroke="#0b122014" stroke-width="1.2"/>

        <rect x="18"  y="95" width="10" height="30" rx="5" fill="${theme.dark}"/>
        <rect x="212" y="95" width="10" height="30" rx="5" fill="${theme.dark}"/>

        <rect x="35" y="30"  width="170" height="70"  rx="18" fill="url(#glass${i})" stroke="${theme.pale}"/>
        <rect x="35" y="130" width="170" height="70"  rx="18" fill="url(#glass${i})" stroke="${theme.pale}"/>

        <path d="M45 112 H195" stroke="#22181522" stroke-width="2"/>
        <path d="M120 30 V200" stroke="#2218151f" stroke-width="1.2"/>

        <rect x="50"  y="14" width="34" height="10" rx="6" fill="url(#head${i})" filter="url(#glow${i})" opacity=".95"/>
        <rect x="156" y="14" width="34" height="10" rx="6" fill="url(#head${i})" filter="url(#glow${i})" opacity=".95"/>
        <rect x="50"  y="206" width="28" height="9" rx="5" fill="url(#tail${i})" filter="url(#glow${i})" opacity=".9"/>
        <rect x="162" y="206" width="28" height="9" rx="5" fill="url(#tail${i})" filter="url(#glow${i})" opacity=".9"/>
      </svg>`;
    }

    let teams=[], colors=[];

    function renderMeta(total, teamCount){
      $meta.innerHTML = [
        `<span class="chip"><span class="dot"></span>ì´ ${total}ëª…</span>`,
        `<span class="chip"><span class="dot"></span>${teamCount}ê°œ íŒ€</span>`
      ].join(' ');
    }

    function render(){
      $cards.innerHTML='';
      if(!teams.length){
        const empty=document.createElement('div'); empty.className='muted';
        empty.style.textAlign='center'; empty.style.padding='60px 0';
        empty.innerHTML='ì´ë¦„ì„ ì…ë ¥í•˜ê³  <b>ëœë¤ ì¡°í¸ì„±</b>ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”!';
        $cards.appendChild(empty); $btnSave.disabled=true; $btnCopy.disabled=true; return;
      }
      $btnSave.disabled=false; $btnCopy.disabled=false;

      teams.forEach((t,i)=>{
        const color = colors[i % colors.length];
        const card=document.createElement('div'); card.className='card';
        const head=document.createElement('div'); head.className='card-head';
        head.innerHTML = `
          <div class="car-id"><span class="id-dot" style="background:${color.base}"></span>${i+1}í˜¸ì°¨</div>
          <div class="team-chip" style="border-color:${color.dark}; background:${color.pale}">
            <span class="chip-dot" style="background:${color.base}"></span>${t.teamName}
          </div>`;

        const carWrap=document.createElement('div'); carWrap.className='car-wrap';
        const svgBox=document.createElement('div'); svgBox.style.position='relative'; svgBox.style.width='240px'; svgBox.style.height='230px'; svgBox.style.margin='0 auto';
        svgBox.innerHTML = svgCar(i, color);

        const seats=[t.members[0],t.members[1],t.members[2],t.members[3]];
        seatLayout.forEach((pos,idx)=>{
          const name=seats[idx]; if(!name) return;
          const seat=document.createElement('div'); seat.className='seat';
          seat.style.left=pos.x+'px'; seat.style.top=pos.y+'px';

          const badge=document.createElement('div'); badge.className='badge'+(idx===0?' driver':'');
          if(idx!==0) badge.style.borderColor = color.dark; // ë³´ë” ì‚´ì§ ì–´ë‘¡ê²Œ
          badge.textContent = name; badge.title=name;
          seat.appendChild(badge);

          if(idx===0){
            const crown=document.createElement('div'); crown.className='crown-float'; crown.textContent='ğŸ‘‘';
            seat.appendChild(crown);
          }

          svgBox.appendChild(seat);
        });

        requestAnimationFrame(()=>fitBadgesInsideCar(svgBox));

        const foot=document.createElement('div'); foot.className='foot';
        foot.innerHTML=`ì¡°ì¥: <b>${t.leader}</b>`;

        carWrap.appendChild(svgBox);
        card.appendChild(head); card.appendChild(carWrap); card.appendChild(foot);
        $cards.appendChild(card);
      });
    }

    function updateCounts(){ $count.textContent=splitNames($names.value).length; }

    /* 3/4 ì¸ì› ë¶„í•  ë¡œì§ */
    function partition34(n){ if(n===1||n===2||n===5) return null; for(let b=Math.floor(n/4); b>=0; b--){const rem=n-4*b; if(rem%3===0) return {a3:rem/3,b4:b}; } return null; }
    function makeGroups34(list){
      const plan=partition34(list.length); if(!plan) return null;
      const s=shuffle(list); const groups=[]; let idx=0;
      for(let i=0;i<plan.b4;i++){groups.push(s.slice(idx,idx+4)); idx+=4;}
      for(let i=0;i<plan.a3;i++){groups.push(s.slice(idx,idx+3)); idx+=3;}
      return groups;
    }
    function pickLeaders(groups){
      const names = uniqueCarNames(groups.length);
      return groups.map((g,i)=>{
        const leaderIdx=Math.floor(Math.random()*g.length);
        const leader=g[leaderIdx]; const others=g.filter((_,k)=>k!==leaderIdx);
        return { teamName:names[i], leader, members:[leader,...others] };
      });
    }

    function make(){
      const names=splitNames($names.value); updateCounts();
      $error.style.display='none';
      if(names.length<3){ $error.style.display='block'; teams=[]; render(); renderMeta(names.length,0); return; }
      const g=makeGroups34(names); if(!g){ $error.style.display='block'; teams=[]; render(); renderMeta(names.length,0); return; }
      teams=pickLeaders(g);
      colors = teamColors(teams.length);
      $titleOut.textContent=$titleIn.value.trim()||'ëœë¤ ëŸ°ì¹˜';
      renderMeta(names.length, teams.length);
      render();
    }

    function sanitizedTitle(t){ return (t||'').replace(/\s+/g,' ').trim().replace(/[\\/:*?"<>|]/g,'-'); }
    function savePng(){
      const title=sanitizedTitle($titleIn.value);
      const fname= title ? `ëœë¤ëŸ°ì¹˜_${title}.png` : 'ëœë¤ëŸ°ì¹˜.png';
      document.querySelectorAll('.car-wrap > div').forEach(fitBadgesInsideCar);
      htmlToImage.toPng($capture,{pixelRatio:2.5,backgroundColor:'#ffffff'})
        .then(url=>{ const a=document.createElement('a'); a.href=url; a.download=fname; a.click(); })
        .catch(()=>alert('ì´ë¯¸ì§€ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì–´ìš”. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.'));
    }
    function copyList(){
      if(!teams.length) return;
      const text=teams.map((t,i)=>`${i+1}íŒ€(${t.teamName}) - ì¡°ì¥:${t.leader} | ${t.members.join(', ')}`).join('\n');
      navigator.clipboard.writeText(text).then(()=>alert('íŒ€ ëª…ë‹¨ì„ ë³µì‚¬í–ˆì–´ìš”!')).catch(()=>alert('ë³µì‚¬ ì‹¤íŒ¨: ë¸Œë¼ìš°ì € ê¶Œí•œì„ í™•ì¸í•˜ì„¸ìš”.'));
    }

    $btnMake.onclick=make; $btnSave.onclick=savePng; $btnCopy.onclick=copyList;
    $names.addEventListener('input', updateCounts); updateCounts();
  </script>
</body>
</html>
